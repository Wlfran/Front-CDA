<div class="form-container">
  <mat-card>
    <mat-card-header>
      <mat-card-title>
        {{ isEdit ? 'Editar Cliente' : 'Nuevo Cliente' }}
      </mat-card-title>
    </mat-card-header>

    <mat-card-content>
      <form [formGroup]="clienteForm" (ngSubmit)="onSubmit()">

        <mat-accordion>

          <!-- ===== Datos del Cliente ===== -->
          <mat-expansion-panel [expanded]="true">
            <mat-expansion-panel-header>
              <mat-panel-title>Datos del Cliente</mat-panel-title>
            </mat-expansion-panel-header>

            <div class="form-row">
              <mat-form-field appearance="outline" class="full-width">
                <mat-label>Nombre</mat-label>
                <input matInput formControlName="nombre" maxlength="200">
                <mat-error *ngIf="clienteForm.get('nombre')?.hasError('required')">
                  El nombre es requerido
                </mat-error>
              </mat-form-field>
            </div>

            <div class="form-row">
              <mat-form-field appearance="outline" class="half-width">
                <mat-label>NIT</mat-label>
                <input matInput formControlName="nit" maxlength="50">
                <mat-error *ngIf="clienteForm.get('nit')?.hasError('required')">
                  El NIT es requerido
                </mat-error>
              </mat-form-field>

              <mat-form-field appearance="outline" class="half-width">
                <mat-label>Email</mat-label>
                <input matInput type="email" formControlName="email" maxlength="150">
                <mat-error *ngIf="clienteForm.get('email')?.hasError('required')">
                  El email es requerido
                </mat-error>
                <mat-error *ngIf="clienteForm.get('email')?.hasError('email')">
                  Email inválido
                </mat-error>
              </mat-form-field>
            </div>

            <div class="form-row">
              <mat-form-field appearance="outline" class="half-width">
                <mat-label>Teléfono</mat-label>
                <input matInput formControlName="telefono" maxlength="50">
                <mat-error *ngIf="clienteForm.get('telefono')?.hasError('required')">
                  El teléfono es requerido
                </mat-error>
              </mat-form-field>

              <mat-form-field appearance="outline" class="half-width">
                <mat-label>Dirección</mat-label>
                <textarea matInput formControlName="direccion" maxlength="300" rows="3"></textarea>
                <mat-error *ngIf="clienteForm.get('direccion')?.hasError('required')">
                  La dirección es requerida
                </mat-error>
              </mat-form-field>
            </div>
          </mat-expansion-panel>

          <!-- ===== Vehículo Inicial ===== -->
          <mat-expansion-panel>
            <mat-expansion-panel-header>
              <mat-panel-title>Vehículo Inicial</mat-panel-title>
            </mat-expansion-panel-header>

            <div formGroupName="vehiculo">
              <div class="form-row">
                <mat-form-field appearance="outline" class="half-width">
                  <mat-label>Placa</mat-label>
                  <input matInput formControlName="placa" maxlength="20">
                  <mat-error *ngIf="clienteForm.get('vehiculo.placa')?.hasError('required')">
                    La placa es requerida
                  </mat-error>
                </mat-form-field>

                <mat-form-field appearance="outline" class="half-width">
                  <mat-label>Marca</mat-label>
                  <input matInput formControlName="marca" maxlength="50">
                  <mat-error *ngIf="clienteForm.get('vehiculo.marca')?.hasError('required')">
                    La marca es requerida
                  </mat-error>
                </mat-form-field>
              </div>

              <div class="form-row">
                <mat-form-field appearance="outline" class="half-width">
                  <mat-label>Modelo</mat-label>
                  <input matInput formControlName="modelo" maxlength="50">
                  <mat-error *ngIf="clienteForm.get('vehiculo.modelo')?.hasError('required')">
                    El modelo es requerido
                  </mat-error>
                </mat-form-field>

                <mat-form-field appearance="outline" class="half-width">
                  <mat-label>Color</mat-label>
                  <input matInput formControlName="color" maxlength="30">
                </mat-form-field>
              </div>

              <div class="form-row">
                <mat-form-field appearance="outline" class="half-width">
                  <mat-label>Año</mat-label>
                  <input matInput type="number" formControlName="año" min="1900" max="2099">
                </mat-form-field>
              </div>
            </div>
          </mat-expansion-panel>

        </mat-accordion>

        <div class="form-actions" style="margin-top: 16px; display: flex; justify-content: flex-end; gap: 10px;">
          <button mat-button type="button" (click)="onCancel()" [disabled]="loading">
            Cancelar
          </button>

          <button mat-raised-button color="primary" type="submit" [disabled]="!clienteForm.valid || loading">
            <mat-spinner *ngIf="loading" diameter="20"></mat-spinner>
            {{ loading ? 'Guardando...' : (isEdit ? 'Actualizar' : 'Crear') }}
          </button>
        </div>

      </form>
    </mat-card-content>
  </mat-card>
</div>
